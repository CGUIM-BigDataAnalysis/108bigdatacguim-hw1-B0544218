---
title: "108-2 大數據分析方法 作業一"
output: github_document
author: 鄭凱元
---

搞不清楚各行各業的薪資差異嗎? 念研究所到底對第一份工作的薪資影響有多大? CP值高嗎? 透過分析**初任人員平均經常性薪資**- （107年）https://data.gov.tw/dataset/6647 （104-105年）http://ipgod.nchc.org.tw/dataset/a17000000j-020066 ，可初步了解台灣近幾年各行各業、各學歷的起薪。

## 比較104年度和107年度大學畢業者的薪資資料

### 資料匯入與處理
```{r dataload}
library(readr)
library(dplyr)
library(jsonlite)
library(stringr)
library(purrr)
library(rvest)
data104 <- read_csv("./104/104occupation.csv", locale = locale(encoding = "BIG5"))
data107 <- read_csv("./107/107occupation.csv")
data = inner_join(data104,data107,by="大職業別") 
# 把資料變成數值型態方便後續計算 
# 欄位.x代表104年 欄位.y代表107年
data$`大學-薪資.x` = as.numeric(gsub("—|…",NA,data$`大學-薪資.x`))
data$`大學-薪資.y` = as.numeric(gsub("—|…",NA,data$`大學-薪資.y`))
data$`大學-女/男.x` = as.numeric(gsub("—|…",NA,data$`大學-女/男.x`))
data$`大學-女/男.y` = as.numeric(gsub("—|…",NA,data$`大學-女/男.y`))
data$`大學-薪資.y` = as.numeric(gsub("—|…",NA,data$`大學-薪資.y`))
data$`研究所-薪資` = as.numeric(gsub("—|…",NA,data$`研究所-薪資`))

```

### 107年度薪資較104年度薪資高的職業有哪些? 
```{r compare103106}
# 欄位BS_increase_ratio 是 107/104大學薪資的比例
data$BS_increase_ratio = data$`大學-薪資.y`/data$`大學-薪資.x`
#將 大學薪資比例 進行降冪排序
sort_data = data[order(data$BS_increase_ratio,decreasing = T), ]
# 大學薪資比例 前10高的資料
knitr::kable(sort_data[1:10,c("大職業別","BS_increase_ratio")] )


```

### 提高超過5%的的職業有哪些? 
```{r over5}
# 印出 大學薪資比例 大於1.05的資料 (並排除掉NA資料)
knitr::kable(sort_data[
  sort_data$BS_increase_ratio > 1.05& !is.na(sort_data$BS_increase_ratio), 
  c("大職業別","BS_increase_ratio")] )

```

### 主要的職業種別是哪些種類呢?
```{r mainType}
# 找出大職業別中 主要的職業種別
get_string = function(dash_locate,occupation){
  return_value = NA
  if(!is.na(dash_locate)){
    # 取出 從第一個字 ~ 符號(-)的前一個字
    return_value = substr(occupation, start = 1,stop=dash_locate - 1)
  }else{
    # 如果沒有符號(-) 直接取 職業別
    return_value = occupation
  }
  return_value
}
# 找出 欄位:大職業別 中各個row 符號(-)的位置
# str_locate 會回傳 字串中 符號第一次出現的位置和最後一次出現的位置 (這裡用[,1]取第一次出現的位置 )
dash_locate = str_locate(data$`大職業別`, "-")[,1]
occupation = data$`大職業別`
# 取得主要的職業種別
main_occupation = unlist(map2(dash_locate,occupation,get_string))
knitr::kable(table(main_occupation) )

```

## 男女同工不同酬現況分析

男女同工不同酬一直是性別平等中很重要的問題，分析資料來源為103到106年度的大學畢業薪資。

### 104和107年度的大學畢業薪資資料，哪些行業男生薪資比女生薪資多?
```{r male}
# 104大學-女/男薪資比例 進行升冪
as_sort_data104 = data[order(data$`大學-女/男.x`), ] 
# 107大學-女/男薪資比例 進行升冪
as_sort_data107 = data[order(data$`大學-女/男.y`), ] 
#小於100 代表男生薪資比女生多
# 104男比女多的前10筆資料
knitr::kable( filter(as_sort_data104,
                     `大學-女/男.x` < 100)[1:10,c("大職業別","大學-女/男.x")] )

#107男比女多的前10筆資料
knitr::kable( filter(as_sort_data107,
                     `大學-女/男.y` < 100)[1:10,c("大職業別","大學-女/男.y")] )


```
### 哪些行業女生薪資比男生薪資多? 
```{r female}
# 104大學-女/男薪資比例 進行降冪
de_sort_data104 = data[order(data$`大學-女/男.x`,decreasing =T ), ] 
# 107大學-女/男薪資比例 進行降冪
de_sort_data107 = data[order(data$`大學-女/男.y`,decreasing =T ), ] 
# 大於100 代表女生薪資比男生多
# 104女比男多的前10筆資料 
# (因為「女生比男生薪資多」的資料不足10筆，所以題目規定印出前10筆時會產生NA的情形)
knitr::kable( filter(de_sort_data104,
                     `大學-女/男.x` > 100)[1:10,c("大職業別","大學-女/男.x")] )
# 107女比男多的前10筆資料 
# (因為「女生比男生薪資多」的資料不足10筆，所以題目規定印出前10筆時會產生NA的情形)
knitr::kable( filter(de_sort_data107,
                     `大學-女/男.y` > 100)[1:10,c("大職業別","大學-女/男.y")] )

```

## 研究所薪資差異

以107年度的資料來看，哪個職業別念研究所最划算呢 (研究所學歷薪資與大學學歷薪資增加比例最多)?
 
```{r grad}
# 欄位MS_BS_ratio 是 研究所-薪資/大學-薪資 的比例
data$MS_BS_ratio = data$`研究所-薪資` / data$`大學-薪資.y`
# 將 MS_BS_data 進行降冪排序
MS_BS_data = data[order(data$MS_BS_ratio,decreasing = T), ]
# 印出MS_BS_ratio 前10高的資料
knitr::kable(MS_BS_data[1:10,c("大職業別","MS_BS_ratio")])

```

## 我有興趣的職業別薪資狀況分析

### 有興趣的職業別篩選，呈現薪資
```{r like}
# 此資料為 1111人力銀行 演算法開發工程師薪水
url = "https://www.jobsalary.com.tw/salarysummary.aspx?codeNo=140207"
salary = read_html(url) %>% html_nodes("div .avgSalaryListPart02") %>% html_text() 
bachelor_s = gsub("\t|\n|\r","",salary[3]) #大學生薪資
master_s = gsub("\t|\n|\r","",salary[4])   #研究所薪資
# 做資料的清洗、型態轉換
bachelor_s = as.numeric(unlist(
                          strsplit (bachelor_s,"\\$"))[2:6])
master_s = as.numeric(unlist(
                          strsplit (master_s,"\\$"))[2:6])
# row1 : 1年以下薪資，row2 : 1~3年薪資，row3 : 3~5年薪資
# row4 : 5~7年薪資，row2 : 7年以上薪資
engineer_salary = data.frame("大學" = bachelor_s,"研究所" = master_s)
knitr::kable(engineer_salary)

```

### 這些職業別研究所薪資與大學薪資差多少呢？
```{r likeGrad}
engineer_salary$differ = engineer_salary$"研究所" - engineer_salary$"大學"
knitr::kable(engineer_salary)

```

