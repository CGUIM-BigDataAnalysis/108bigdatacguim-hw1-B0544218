---
title: "108-2 大數據分析方法 作業一"
output: github_document
author: 鄭凱元
---

搞不清楚各行各業的薪資差異嗎? 念研究所到底對第一份工作的薪資影響有多大? CP值高嗎? 透過分析**初任人員平均經常性薪資**- （107年）https://data.gov.tw/dataset/6647 （104-105年）http://ipgod.nchc.org.tw/dataset/a17000000j-020066 ，可初步了解台灣近幾年各行各業、各學歷的起薪。

## 比較104年度和107年度大學畢業者的薪資資料

### 資料匯入與處理
```{r dataload}
library(readr)
library(dplyr)
library(jsonlite)
library(stringr)
library(purrr)
library(rvest)
data104 <- read_csv("./104/104occupation.csv", locale = locale(encoding = "BIG5"))
data107 <- read_csv("./107/107occupation.csv")
data = inner_join(data104,data107,by="大職業別") 
# 把資料變成數值型態方便後續計算 
# 欄位.x代表104年 欄位.y代表107年
data$`大學-薪資.x` = as.numeric(gsub("—|…",NA,data$`大學-薪資.x`))
data$`大學-薪資.y` = as.numeric(gsub("—|…",NA,data$`大學-薪資.y`))
data$`大學-女/男.x` = as.numeric(gsub("—|…",NA,data$`大學-女/男.x`))
data$`大學-女/男.y` = as.numeric(gsub("—|…",NA,data$`大學-女/男.y`))
data$`大學-薪資.y` = as.numeric(gsub("—|…",NA,data$`大學-薪資.y`))
data$`研究所-薪資` = as.numeric(gsub("—|…",NA,data$`研究所-薪資`))

```

### 107年度薪資較104年度薪資高的職業有哪些? 
```{r compare103106}
#欄位BS_increase_ratio 是 107/104大學薪資的比例
data$BS_increase_ratio = data$`大學-薪資.y`/data$`大學-薪資.x`
#將 大學薪資比例 進行降冪排序
sort_data = data[order(data$BS_increase_ratio,decreasing = T), ]
#大學薪資比例 前10高的資料
knitr::kable(sort_data[1:10,c("大職業別","BS_increase_ratio")] )
# 說明 : 
# 根據全教總新聞稿，軍公教的薪資從104到107年度，薪水增幅從2.5%、0.5%、2.5%到107年度增加了3.8%，因此許多教育業相關人的薪水都跟著增長
# 而廠商調升薪資通常是依照員工個人表現、基本薪資和營利狀況。而104到107年許多科技公司的營利上漲，因此底下的技術人員的薪水也跟著增加
# 娛樂及休閒或住宿及餐飲業則是空缺率107比104高，又因為基本薪資等因素，店家為了找人而開出高價

```

### 提高超過5%的的職業有哪些? 
```{r over5}
#印出 大學薪資比例 大於1.05的資料 (並排除掉NA資料)
knitr::kable(sort_data[
  sort_data$BS_increase_ratio > 1.05& !is.na(sort_data$BS_increase_ratio), 
  c("大職業別","BS_increase_ratio")] )

```

### 主要的職業種別是哪些種類呢?
```{r mainType}
#找出大職業別中 主要的職業種別
get_string = function(dash_locate,occupation){
  return_value = NA
  if(!is.na(dash_locate)){
    #取出 從第一個字 ~ 符號(-)的前一個字
    return_value = substr(occupation, start = 1,stop=dash_locate - 1)
  }else{
    #如果沒有符號(-) 直接取 職業別
    return_value = occupation
  }
  return_value
}
#找出 欄位:大職業別 中各個row 符號(-)的位置
#str_locate 會回傳 字串中 符號第一次出現的位置和最後一次出現的位置 (這裡用[,1]取第一次出現的位置 )
dash_locate = str_locate(data$`大職業別`, "-")[,1]
occupation = data$`大職業別`
#取得主要的職業種別
main_occupation = unlist(map2(dash_locate,occupation,get_string))
knitr::kable(table(main_occupation) )

```

## 男女同工不同酬現況分析

男女同工不同酬一直是性別平等中很重要的問題，分析資料來源為103到106年度的大學畢業薪資。

### 104和107年度的大學畢業薪資資料，哪些行業男生薪資比女生薪資多?
```{r male}
#104大學-女/男薪資比例 進行升冪
as_sort_data104 = data[order(data$`大學-女/男.x`), ] 
#107大學-女/男薪資比例 進行升冪
as_sort_data107 = data[order(data$`大學-女/男.y`), ] 
#小於100 代表男生薪資比女生多
#104男比女多的前10筆資料
knitr::kable( filter(as_sort_data104,
                     `大學-女/男.x` < 100)[1:10,c("大職業別","大學-女/男.x")] )

#107男比女多的前10筆資料
knitr::kable( filter(as_sort_data107,
                     `大學-女/男.y` < 100)[1:10,c("大職業別","大學-女/男.y")] )

# 不管是104 還是107，女/男薪資比例前10的產業類別並沒有發生多大的變化
# 在數據中 可看出前10主要都是礦業、電力燃氣業的職業類別
# 而上述的職業類別可能常需要加班 但Claudia Goldin在經濟學年會指出 女生要求的工時彈性要比男生大
# 綜合上述原因，不管事104、107年的前10名，男生y在這類型的工作中 薪資高於女性

```
### 哪些行業女生薪資比男生薪資多? 
```{r female}
#104大學-女/男薪資比例 進行降冪
de_sort_data104 = data[order(data$`大學-女/男.x`,decreasing =T ), ] 
#107大學-女/男薪資比例 進行降冪
de_sort_data107 = data[order(data$`大學-女/男.y`,decreasing =T ), ] 
#大於100 代表女生薪資比男生多
#104女比男多的前10筆資料 (如果有NA就代表女生比男生的資料不足10筆)
knitr::kable( filter(de_sort_data104,
                     `大學-女/男.x` > 100)[1:10,c("大職業別","大學-女/男.x")] )
#107女比男多的前10筆資料 (如果有NA就代表女生比男生的資料不足10筆)
knitr::kable( filter(de_sort_data107,
                     `大學-女/男.y` > 100)[1:10,c("大職業別","大學-女/男.y")] )
# 在職業別中女生薪資比男生薪資多的只有一項(而且差距非常小)
# 從這項資料可看出 女生在這些職業別中薪資並不會比男生多
# 而且也並不是工時彈性的問題
# 由於沒有合理的資訊可以佐證，因此參考PTT上的資料來說，同一類別的工作，之所以有女生薪資比男生少的原因可能是傳統的性別歧視問題
```

## 研究所薪資差異

以107年度的資料來看，哪個職業別念研究所最划算呢 (研究所學歷薪資與大學學歷薪資增加比例最多)?
 
```{r grad}
#欄位MS_BS_ratio 是 研究所-薪資/大學-薪資 的比例
data$MS_BS_ratio = data$`研究所-薪資` / data$`大學-薪資.y`
#將 MS_BS_data 進行降冪排序
MS_BS_data = data[order(data$MS_BS_ratio,decreasing = T), ]
#印出MS_BS_ratio 前10高的資料
knitr::kable(MS_BS_data[1:10,c("大職業別","MS_BS_ratio")])
# 研究所薪資差異前10 以其他服務、科技業、工業佔比最多
# 其他服務業的幹部人員可能要求研究所學歷，而幹部的薪資可能又跟一般人員的薪資差異大所導致
# 工業、科技業門檻高的工作，企業通常比較偏好碩士學位的人員，又由於近年來高科技產業職缺問題，公司願意花較多的錢來雇用這些人員
```

## 我有興趣的職業別薪資狀況分析

### 有興趣的職業別篩選，呈現薪資
```{r like}
#此資料為 1111人力銀行 演算法開發工程師薪水
url = "https://www.jobsalary.com.tw/salarysummary.aspx?codeNo=140207"
salary = read_html(url) %>% html_nodes("div .avgSalaryListPart02") %>% html_text() 
bachelor_s = gsub("\t|\n|\r","",salary[3]) #大學生薪資
master_s = gsub("\t|\n|\r","",salary[4])   #研究所薪資
#做資料的清洗、型態轉換
bachelor_s = as.numeric(unlist(
                          strsplit (bachelor_s,"\\$"))[2:6])
master_s = as.numeric(unlist(
                          strsplit (master_s,"\\$"))[2:6])
# row1 : 1年以下薪資，row2 : 1~3年薪資，row3 : 3~5年薪資
# row4 : 5~7年薪資，row2 : 7年以上薪資
engineer_salary = data.frame("大學" = bachelor_s,"研究所" = master_s)
knitr::kable(engineer_salary)
# 明顯看出 大學與研究所在這行業的差異還是滿明顯的 (跟工作門檻有關)
# 1年以下的薪資跟預期的差不多
# 但從3~7年以上的薪資漲幅比 就沒有預想中的多 如果以AI工程師來說 7年以上應該 至少7萬(而不是平均7萬)
# 推測可能是資料不足，以及如果只講演算法工程師，所涉及到的領域非常多 可能某些領域的工程師薪水並不如我預期，進而拉低水平
```

### 這些職業別研究所薪資與大學薪資差多少呢？
```{r likeGrad}
engineer_salary$differ = engineer_salary$"研究所" - engineer_salary$"大學"
knitr::kable(engineer_salary)
# 差距大概在9k~10k，但前面也說過演算法工程師，其實又可以分得很細，以我自己想走的領域ComputerVision來說，薪資差異可能就不只10K(再加上這個領域，大部分企業都比較偏好碩士生)，因此只要薪資不是差距太小，我認為讀研究所還是有其必要的。
```

